/*
Copyright 2013, KISSY v1.40
MIT Licensed
build time: Oct 30 22:14
*/
KISSY.add("combobox/combobox-xtpl",function(){return function(h,a,e){var g=this,a=this.config.utils,i=a.runBlockCommand,f=a.getExpression,c=a.getPropertyOrRunCommand,a='<div id="ks-combobox-invalid-el-',b=c(g,h,{},"id",0,1,e,!1),a=a+f(b,!0),a=a+'"\r\n     class="',b={},d=[];d.push("invalid-el");b.params=d;b=c(g,h,b,"getBaseCssClasses",0,2,!0,e);a=a+b+'">\r\n    <div class="';b={};d=[];d.push("invalid-inner");b.params=d;var b=c(g,h,b,"getBaseCssClasses",0,3,!0,e),a=a+b+'"></div>\r\n</div>\r\n\r\n',
b={},d=[],k=c(g,h,{},"hasTrigger",0,6,e,!0);d.push(k);b.params=d;b.fn=function(b){var d;d='\r\n<div id="ks-combobox-trigger-';var a=c(g,b,{},"id",0,7,e,!1);d+=f(a,!0);d+='"\r\n     class="';var a={},k=[];k.push("trigger");a.params=k;a=c(g,b,a,"getBaseCssClasses",0,8,!0,e);d=d+a+'">\r\n    <div class="';a={};k=[];k.push("trigger-inner");a.params=k;b=c(g,b,a,"getBaseCssClasses",0,9,!0,e);return d+b+'">&#x25BC;</div>\r\n</div>\r\n'};a+=i(g,h,b,"if",6);a+='\r\n\r\n<div class="';b={};d=[];d.push("input-wrap");
b.params=d;b=c(g,h,b,"getBaseCssClasses",0,13,!0,e);a=a+b+'">\r\n\r\n    <input id="ks-combobox-input-';b=c(g,h,{},"id",0,15,e,!1);a+=f(b,!0);a+='"\r\n           aria-haspopup="true"\r\n           aria-autocomplete="list"\r\n           aria-haspopup="true"\r\n           role="autocomplete"\r\n           aria-expanded="false"\r\n\r\n    ';b={};d=[];k=c(g,h,{},"disabled",0,22,e,!0);d.push(k);b.params=d;b.fn=function(){return"\r\n    disabled\r\n    "};a+=i(g,h,b,"if",22);a+='\r\n\r\n    autocomplete="off"\r\n    class="';
b={};d=[];d.push("input");b.params=d;b=c(g,h,b,"getBaseCssClasses",0,27,!0,e);a=a+b+'"\r\n\r\n    value="';b=c(g,h,{},"value",0,29,e,!1);a+=f(b,!0);a+='"\r\n    />\r\n\r\n\r\n    <label id="ks-combobox-placeholder-';b=c(g,h,{},"id",0,33,e,!1);a+=f(b,!0);a+='"\r\n           for="ks-combobox-input-';b=c(g,h,{},"id",0,34,e,!1);a+=f(b,!0);a+="\"\r\n            style='display:";b={};d=[];k=c(g,h,{},"value",0,35,e,!0);d.push(k);b.params=d;b.fn=function(){return"none"};b.inverse=function(){return"block"};
a+=i(g,h,b,"if",35);a+=";'\r\n    class=\"";i={};b=[];b.push("placeholder");i.params=b;i=c(g,h,i,"getBaseCssClasses",0,36,!0,e);a=a+i+'">\r\n    ';h=c(g,h,{},"placeholder",0,37,e,!1);a+=f(h,!0);return a+"\r\n    </label>\r\n</div>\r\n"}});
KISSY.add("combobox/render",function(h,a,e){return a.getDefaultRender().extend({beforeCreateDom:function(a,e){h.mix(e,{input:"#ks-combobox-input-{id}",trigger:"#ks-combobox-trigger-{id}",invalidEl:"#ks-combobox-invalid-el-{id}",placeholderEl:"#ks-combobox-placeholder-{id}"})},getKeyEventTarget:function(){return this.control.get("input")},_onSetCollapsed:function(a){this.control.get("input").attr("aria-expanded",!a)},_onSetDisabled:function(a,e){this.callSuper(a,e);this.control.get("input").attr("disabled",
a)}},{ATTRS:{contentTpl:{value:e}},HTML_PARSER:{value:function(a){return a.one("."+this.getBaseCssClass("input")).val()},input:function(a){return a.one("."+this.getBaseCssClass("input"))},trigger:function(a){return a.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(a){return a.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(a){return a.one("."+this.getBaseCssClass("placeholder"))}}})},{requires:["component/control","./combobox-xtpl"]});
KISSY.add("combobox/control",function(h,a,e,g,i,f){function c(l){for(var b=0;b<l.length;b++)if(!l[b].get("disabled"))return l[b];return null}function b(){r(this)}function d(){var b=this;setTimeout(function(){n(b)},0)}function k(){this.focus();n(this)}function s(){this.setValueFromAutocomplete(this.getValueForAutocomplete(),{force:1})}function q(b){b=b.target;b.isMenuItem&&(b=b.get("textContent"),this.setValueFromAutocomplete(b),this._savedValue=b,this.set("collapsed",!0))}function j(b,a){var d=b.$el,
k=b.view.getBaseCssClasses("invalid"),c=b.get("invalidEl");a?(d.addClass(k),c.attr("title",a),c.show()):(d.removeClass(k),c.hide())}function r(b){b._focusoutDismissTimer||(b._focusoutDismissTimer=setTimeout(function(){b._focusoutDismissTimer&&b.set("collapsed",!0)},50))}function n(b){var a;if(a=b._focusoutDismissTimer)clearTimeout(a),b._focusoutDismissTimer=null}function o(b){this.set("value",b.newVal,{data:{causedByTimer:1}})}function p(b){var a,d=[],k,c,d=this.get("menu"),b=this.normalizeData(b);
d.removeChildren(!0);(c=d.get("highlightedItem"))&&c.set("highlighted",!1);if(b&&b.length){for(c=0;c<b.length;c++)a=b[c],d.addChild(a);d=d.get("children");b=this.getValueForAutocomplete();if(this.get("highlightMatchItem"))for(c=0;c<d.length;c++)if(d[c].get("textContent")==b){d[c].set("highlighted",!0);k=!0;break}if(!k&&this.get("autoHighlightFirst"))for(c=0;c<d.length;c++)if(!d[c].get("disabled")){d[c].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",
!0)}var m=a.KeyCode;return e.extend([],{initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,normalizeData:function(b){var a,d,c;if(b&&b.length){b=b.slice(0,this.get("maxItemCount"));a=this.get("format")?this.get("format").call(this,this.getValueForAutocomplete(),b):[];for(c=0;c<b.length;c++)d=b[c],a[c]=h.mix({content:d,textContent:d,value:d},a[c])}return a},bindUI:function(){var a=this;a.get("input").on("valuechange",o,a);a.on("click",q,a);a.get("menu").onRendered(function(c){var g=
a.get("input"),e=c.get("el"),c=c.get("contentEl");g.attr("aria-owns",e.attr("id"));e.on("focusout",b,a);e.on("focusin",d,a);c.on("mouseover",k,a);c.on("mousedown",s,a)})},destructor:function(){this.get("menu").destroy()},getValueForAutocomplete:function(){return this.get("value")},setValueFromAutocomplete:function(b,a){this.set("value",b,a)},_onSetValue:function(b,a){var d;a.causedByTimer?(d=this.getValueForAutocomplete(),d===f?this.set("collapsed",!0):(this._savedValue=d,this.sendRequest(d))):this.get("input").val(b)},
handleFocusInternal:function(){var b;this.get("invalidEl")&&j(this,!1);(b=this.get("placeholderEl"))&&b.hide()},handleBlurInternal:function(b){var a=this,d=a.get("placeholderEl");a.callSuper(b);r(a);a.get("invalidEl")&&a.validate(function(b,d){b?!a.get("focused")&&d==a.get("value")&&j(a,b):j(a,!1)});d&&!a.get("value")&&d.show()},handleMouseDownInternal:function(b){var a,d;this.callSuper(b);a=b.target;if((d=this.get("trigger"))&&(d[0]==a||d.contains(a)))this.get("collapsed")?(this.focus(),this.sendRequest("")):
this.set("collapsed",!0),b.preventDefault()},handleKeyDownInternal:function(b){var a,d=b.keyCode,k,g=this.get("menu");this.get("input");a=this.get("updateInputOnDownUp");if(g.get("visible")){k=g.get("highlightedItem");if(a&&k){var e=g.get("children");if(d==m.DOWN&&k==c(e.concat().reverse())||d==m.UP&&k==c(e))return this.setValueFromAutocomplete(this._savedValue),k.set("highlighted",!1),!0}b=g.handleKeyDownInternal(b);k=g.get("highlightedItem");if(d==m.ESC)return this.set("collapsed",!0),a&&this.setValueFromAutocomplete(this._savedValue),
!0;a&&h.inArray(d,[m.DOWN,m.UP])&&this.setValueFromAutocomplete(k.get("textContent"));return d==m.TAB&&k&&(k.handleClickInternal(),this.get("multiple"))?!0:b}if(d==m.DOWN||d==m.UP)if(a=this.getValueForAutocomplete(),a!==f)return this.sendRequest(a),!0;return f},validate:function(b){var a=this.get("validator"),d=this.getValueForAutocomplete();a?a(d,function(a){b(a,d)}):b(!1,d)},sendRequest:function(b){this.get("dataSource").fetchData(b,p,this)},_onSetCollapsed:function(b){var a=this.$el,d=this.get("menu");
b?d.hide():(n(this),d.get("visible")||(this.get("matchElWidth")&&(d.render(),b=d.get("el"),b=(parseInt(b.css("borderLeftWidth"))||0)+(parseInt(b.css("borderRightWidth"))||0),d.set("width",a[0].offsetWidth-b)),d.show()))}},{ATTRS:{input:{},value:{value:"",sync:0,view:1},trigger:{},placeholder:{view:1},placeholderEl:{},validator:{},invalidEl:{},allowTextSelection:{value:!0},hasTrigger:{value:!0,view:1},menu:{value:{},getter:function(b){b.isControl||(b.xclass=b.xclass||"popupmenu",b=this.createComponent(b),
this.setInternal("menu",b));return b},setter:function(b){if(b.isControl){b.setInternal("parent",this);var a={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};h.mix(b.get("align"),a,!1)}}},collapsed:{view:1,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0},xrender:{value:g}},xclass:"combobox"})},{requires:["node","component/control","./render","menu"]});
KISSY.add("combobox/cursor",function(h,a){function e(b){var a=f;a||(a=g(i));"textarea"==""+b[0].type.toLowerCase()?a.css("width",b.css("width")):a.css("width",9999);h.each(c,function(c){a.css(c,b.css(c))});f||a.insertBefore(b[0].ownerDocument.body.firstChild);return f=a}var g=a.all,i="<div style='z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;'></div>",f,c="paddingLeft,paddingTop,paddingBottom,paddingRight,marginLeft,marginTop,marginBottom,marginRight,borderLeftStyle,borderTopStyle,borderBottomStyle,borderRightStyle,borderLeftWidth,borderTopWidth,borderBottomWidth,borderRightWidth,line-height,outline,height,fontFamily,fontSize,fontWeight,fontVariant,fontStyle".split(",");
return function(b){var a=g(b),b=a[0],c=b.ownerDocument,f=g(c),q=b.scrollTop,j=b.scrollLeft;if(c.selection)return b=c.selection.createRange(),{left:b.boundingLeft+j+f.scrollLeft(),top:b.boundingTop+q+b.boundingHeight+f.scrollTop()};f=a.offset();if("textarea"!=b.type)return f.top+=b.offsetHeight,f;c=e(a);a=b.selectionStart;c.html(h.escapeHtml(b.value.substring(0,a-1))+"<span>x</span>");c.offset(f);f=c.last();b=f.offset();b.top+=f.height();0<a&&(b.left+=f.width());b.top-=q;b.left-=j;return b}},{requires:["node"]});
KISSY.add("combobox/multi-value-combobox",function(h,a,e){function g(b,a){return a&&-1!=b.indexOf(a)}function i(b){b.newVal&&b.target==this.get("menu")&&this.alignWithCursor()}function f(a){var k=a.get("input"),e=a.get("value"),f=[],j=[],h=a.get("literal"),i=a.get("separator"),a=a.get("separatorType"),o=!1,p=a!=c,k=k.prop("selectionStart"),m,l,t=-1;for(m=0;m<e.length;m++)(l=e.charAt(m),h&&l==h&&(o=!o),o)?j.push(l):(m==k&&(t=f.length),p&&b.test(l))?(j.length&&f.push(j.join("")),j=[],j.push(l)):g(i,
l)?a==c?(j.push(l),j.length&&f.push(j.join("")),j=[]):(j.length&&f.push(j.join("")),j=[],j.push(l)):j.push(l);j.length&&f.push(j.join(""));f.length||f.push("");-1==t&&(a==c&&g(i,l)&&f.push(""),t=f.length-1);return{tokens:f,cursorPosition:k,tokenIndex:t}}var c="suffix",b=/\s|\xa0/;return e.extend({syncUI:function(){var b;this.get("alignWithCursor")&&(b=this.get("menu"),b.setInternal("align",null),b.on("beforeVisibleChange",i,this))},getValueForAutocomplete:function(){var b=f(this),a=b.tokens,e=b.tokenIndex,
b=this.get("separator"),h=this.get("separatorType"),a=a[e],e=a.length-1;if(h!=c)if(g(b,a.charAt(0)))a=a.slice(1);else return;else h==c&&g(b,a.charAt(e))&&(a=a.slice(0,e));return a},setValueFromAutocomplete:function(a,e){var h=this.get("input"),i=f(this),j=i.tokens,i=Math.max(0,i.tokenIndex),r=this.get("separator"),n;n=this.get("separatorType");var o=j[i+1]||"",p=j[i];if(n!=c){if(j[i]=p.charAt(0)+a,!o||!b.test(o.charAt(0)))a&&(j[i]+=" ")}else j[i]=a,n=p.length-1,g(r,p.charAt(n))?j[i]+=p.charAt(n):
1==r.length&&(j[i]+=r);i=j.slice(0,i+1).join("").length;this.set("value",j.join(""),e);h.prop("selectionStart",i);h.prop("selectionEnd",i)},alignWithCursor:function(){var b=this.get("menu"),c;c=this.get("input");c=a(c);b.move(c.left,c.top)}},{ATTRS:{separator:{value:",;"},separatorType:{value:c},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})},{requires:["./cursor","./control"]});
KISSY.add("combobox/filter-select",function(h,a){return a.extend({validate:function(a){var g=this;g.callSuper(function(i,f){i?a(i,f):g.get("dataSource").fetchData(f,function(c){a:{if(c=g.normalizeData(c))for(var b=0;b<c.length;b++)if(c[b].textContent==f){c=c[b];break a}c=!1}a(c?"":g.get("invalidMessage"),f,c)})})}},{ATTRS:{invalidMessage:{value:"invalid input"}}})},{requires:["./control"]});
KISSY.add("combobox/local-data-source",function(h,a){return a.extend({fetchData:function(a,g,i){var f=this.get("parse"),c=this.get("data"),c=f(a,c);g.call(i,c)}},{ATTRS:{data:{value:[]},parse:{value:function(a,g){var i=[],f=0;if(!a)return g;h.each(g,function(c){-1!=c.indexOf(a)&&i.push(c);f++});return i}}}})},{requires:["base"]});
KISSY.add("combobox/remote-data-source",function(h,a,e,g){return e.extend({fetchData:function(e,f,c){var b=this,d,h=b.get("paramName"),s=b.get("parse"),q=b.get("cache"),j=b.get("allowEmpty");b.caches=b.caches||{};b.io&&(b.io.abort(),b.io=null);if(!e&&!0!==j)return f.call(c,[]);if(q&&(d=b.caches[e]))return f.call(c,d);d=b.get("xhrCfg");d.data=d.data||{};d.data[h]=e;d.success=function(a){s&&(a=s(e,a));b.setInternal("data",a);q&&(b.caches[e]=a);f.call(c,a)};b.io=a(d);return g}},{ATTRS:{paramName:{value:"q"},
allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})},{requires:["io","base"]});KISSY.add("combobox",function(h,a,e,g,i,f){a.LocalDataSource=i;a.RemoteDataSource=f;a.FilterSelect=g;a.MultiValueComboBox=e;return a},{requires:["combobox/control","combobox/multi-value-combobox","combobox/filter-select","combobox/local-data-source","combobox/remote-data-source"]});
