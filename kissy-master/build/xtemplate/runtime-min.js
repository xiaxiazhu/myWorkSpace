/*
Copyright 2013, KISSY v1.40dev
MIT Licensed
build time: Sep 17 23:11
*/
KISSY.add("xtemplate/runtime/commands",function(g){var j;return j={each:function(c,b){var a=b.params[0],e="",d;if(a){var h=[0,0].concat(c);if(g.isArray(a)){d=a.length;for(var k=0;k<d;k++)h[0]=a[k],h[1]={xcount:d,xindex:k},e+=b.fn(h)}else for(d in a)h[0]=a[d],h[1]={xindex:d},e+=b.fn(h)}else b.inverse&&(e=b.inverse(c));return e},"with":function(c,b){var a=b.params[0],e=[0].concat(c),d="";a?(e[0]=a,d=b.fn(e)):b.inverse&&(d=b.inverse(c));return d},"if":function(c,b){var a="";b.params[0]?b.fn&&(a=b.fn(c)):
b.inverse&&(a=b.inverse(c));return a},set:function(c,b){for(var a=c.length-1;0<=a;a--)if("object"==typeof c[a]){g.mix(c[a],b.hash);break}return""},include:function(c,b){var a=b.params,c=(b.hash?[b.hash]:[]).concat(c);if(!a||1!=a.length)return"include must has one param","";var e=this.config.name,a=a[0];if("."==a.charAt(0)){if("unspecified"==e)return"parent template does not have name for relative sub tpl name: "+a,"";a=g.Path.resolve(e,"../",a)}e=this.config.loader.call(this,a);b=g.merge(this.config);
b.name=a;b.commands=this.config.commands;b.macros=this.config.macros;return this.invokeEngine(e,c,b)},macro:function(c,b){var a=b.params,e=a[0],d=a.slice(1),a=this.config.macros;if(b.fn)a[e]||(a[e]={paramNames:d,fn:b.fn});else{var h={},a=a[e];a||(a=g.require(e))||"can not find macro module:"+name;g.each(a.paramNames,function(a,b){h[a]=d[b]});e=c.concat();e.unshift(h);return a.fn.call(this,e)}return""},parse:function(c,b){return j.include.call(this,[],b)}}});
KISSY.add("xtemplate/runtime",function(g,j,c){function b(a){a}function a(a,b){for(var e=b.split("."),c=a,d=e.length,f=0;f<d&&!(c=c[e[f]],!c);f++);return c}function e(a,b,c){"."===a&&(a="this");var a=a.split("."),e=a.length,d=c||0,f,g,h,i=b.length;"root"==a[0]&&(d=i-1,a.shift(),e--);for(;d<i;d++){f=b[d];h=1;for(c=0;c<e;c++)if(g=a[c],"this"!==g){if("object"!=typeof f||!(g in f)){h=0;break}f=f[g]}if(h)return"function"==typeof f&&(f=f.call(b[0])),[f]}return!1}function d(a,b){this.tpl=a;b=g.merge(o,b);
b.commands=g.merge(b.commands,j);b.utils=k;b.macros=b.macros||{};this.config=b}var h=g.escapeHtml,k={runBlockCommand:function(p,d,h,n,j){var f=p.config,l=f.silent?b:g.error,k=f.commands,f=a(k,n);if(!f)if(!h.params&&!h.hash){var i=e(n,d);!1===i?(l("can not find property: '"+n+"' at line "+j),i=""):i=i[0];f=k["if"];g.isArray(i)?f=k.each:"object"==typeof i&&(f=k["with"]);h.params=[i]}else return"can not find command module: "+n+"' at line "+j,"";l="";try{l=f.call(p,d,h)}catch(m){m.message+": '"+n+"' at line "+
j}l===c&&(l="");return l},getExpression:function(a,b){a===c&&(a="");return b&&a?h(a):a},getPropertyOrRunCommand:function(d,q,k,j,o,f,l,r){var i,m=d.config,s=a(m.commands,j),m=m.silent?b:g.error;if(s)try{i=s.call(d,q,k)}catch(t){return t.message+": '"+j+"' at line "+f,""}else{d=e(j,q,o);if(!1===d)return m("can not find property: '"+j+"' at line "+f,"warn"),r?c:"";i=d[0]}!r&&i===c&&(i="");return l&&i?h(i):i}},o={silent:!0,name:"unspecified",loader:function(a){var b=g.require(a);b||'template "'+a+'" does not exist, need to be required or used first!';
return b}};g.mix(d,{commands:j,utils:k,addCommand:function(a,b){j[a]=b},removeCommand:function(a){delete j[a]}});d.prototype={constructor:d,invokeEngine:function(a,b,c){return(new this.constructor(a,c)).render(b,!0)},removeCommand:function(a){delete this.config.commands[a]},addCommand:function(a,b){this.config.commands[a]=b},render:function(a,b){b||(a=[a]);return this.tpl(a,g)}};return d},{requires:["./runtime/commands"]});
