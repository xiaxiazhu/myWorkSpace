/*
Copyright 2013, KISSY v1.40
MIT Licensed
build time: Sep 17 23:08
*/
KISSY.add("filter-menu/render-xtpl",function(){return function(e,b,d){var b=this.config.utils,c=b.getExpression,f=b.getPropertyOrRunCommand,b='<div id="ks-filter-menu-input-wrap-',a=f(this,e,{},"id",0,1,d,!1),b=b+c(a,!0),b=b+'"\r\n     class="',a={},i=[];i.push("input-wrap");a.params=i;a=f(this,e,a,"getBaseCssClasses",0,2,!0,d);b=b+a+'">\r\n    <div id="ks-filter-menu-placeholder-';a=f(this,e,{},"id",0,3,d,!1);b+=c(a,!0);b+='"\r\n         class="';a={};i=[];i.push("placeholder");a.params=i;a=f(this,
e,a,"getBaseCssClasses",0,4,!0,d);b=b+a+'">\r\n        ';a=f(this,e,{},"placeholder",0,5,d,!1);b+=c(a,!0);b+='\r\n    </div>\r\n    <input id="ks-filter-menu-input-';a=f(this,e,{},"id",0,7,d,!1);b+=c(a,!0);b+='"\r\n           class="';c={};a=[];a.push("input");c.params=a;c=f(this,e,c,"getBaseCssClasses",0,8,!0,d);b=b+c+'"\r\n            autocomplete="off"/>\r\n</div>\r\n';c={};a=[];a.push("component/extension/content-render/content-xtpl");c.params=a;e=f(this,e,c,"include",0,11,!1,d);return b+e}});
KISSY.add("filter-menu/render",function(e,b,d,c,f){return d.getDefaultRender().extend([f],{beforeCreateDom:function(a,c){e.mix(c,{placeholderEl:"#ks-filter-menu-placeholder-{id}",filterInputWrap:"#ks-filter-menu-input-wrap-{id}",filterInput:"#ks-filter-menu-input-{id}"})},getKeyEventTarget:function(){return this.control.get("filterInput")},_onSetPlaceholder:function(a){this.control.get("placeholderEl").html(a)}},{ATTRS:{contentTpl:{value:c}},HTML_PARSER:{placeholderEl:function(a){return a.one("."+
this.getBaseCssClass("placeholder"))},filterInputWrap:function(a){return a.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(a){return a.one("."+this.getBaseCssClass("input"))}}})},{requires:["node","menu","./render-xtpl","component/extension/content-render"]});
KISSY.add("filter-menu",function(e,b,d){return b.extend({bindUI:function(){this.get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnterInternal:function(c){this.callSuper(c);this.view.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var c;c=this.get("filterInput");var b=this.get("highlightedItem");this.set("filterStr",c.val());c=c.val();this.get("allowMultiple")&&(c=c.replace(/^.+,/,""));if(!c&&b)b.set("highlighted",!1);else if(c&&(!b||!b.get("visible")))(b=
this._getNextEnabledHighlighted(0,1))&&b.set("highlighted",!0)},_onSetFilterStr:function(c){this.filterItems(c)},filterItems:function(c){var b=this.get("prefixCls"),a=this.get("placeholderEl"),d=this.get("filterInput");a[c?"hide":"show"]();if(this.get("allowMultiple")){var a=[],h;h=c.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var g=[];h&&(g=h[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(c)?(a=[],h&&(a=g,h=g[g.length-1],(g=(g=this.get("highlightedItem"))&&g.get("content"))&&-1<g.indexOf(h)&&h&&(a[a.length-
1]=g),d.val(a.join(",")+",")),c=""):(h&&(c=h[2]||""),a=g);this.get("enteredItems").length!=a.length&&this.set("enteredItems",a)}var d=this.get("children"),j=c&&RegExp(e.escapeRegExp(c),"ig");e.each(d,function(a){var d=a.get("content");c?-1<d.indexOf(c)?(a.set("visible",!0),a.get("el").html(d.replace(j,function(a){return"<span class='"+b+"menuitem-hit'>"+a+"</span>"}))):a.set("visible",!1):(a.get("el").html(d),a.set("visible",!0))})},reset:function(){this.set("filterStr","");this.set("enteredItems",
[]);this.get("filterInput").val("")}},{ATTRS:{allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:d}},xclass:"filter-menu"})},{requires:["menu","filter-menu/render"]});
