/*
Copyright 2013, KISSY v1.40
MIT Licensed
build time: Sep 17 23:10
*/
KISSY.add("tree/node-xtpl",function(){return function(d,g,f){var a,c=this;a=this.config.utils;var g=a.runBlockCommand,i=a.getExpression,h=a.getPropertyOrRunCommand;a='<div id="ks-tree-node-row-';var b=h(c,d,{},"id",0,1,f,!1);a+=i(b,!0);a+='"\r\n     class="';var b={},e=[];e.push("row");b.params=e;b=h(c,d,b,"getBaseCssClasses",0,2,!0,f);a=a+b+"\r\n     ";var b={},e=[],j=h(c,d,{},"selected",0,3,f,!0);e.push(j);b.params=e;b.fn=function(b){var a;a="\r\n        ";var i={},e=[];e.push("selected");i.params=
e;b=h(c,b,i,"getBaseCssClasses",0,4,!0,f);return a+b+"\r\n     "};a+=g(c,d,b,"if",3);a+='\r\n     ">\r\n    <div id="ks-tree-node-expand-icon-';b=h(c,d,{},"id",0,7,f,!1);a+=i(b,!0);a+='"\r\n         class="';b={};e=[];e.push("expand-icon");b.params=e;b=h(c,d,b,"getBaseCssClasses",0,8,!0,f);a=a+b+'">\r\n    </div>\r\n    ';b={};e=[];j=h(c,d,{},"checkable",0,10,f,!0);e.push(j);b.params=e;b.fn=function(b){var a;a='\r\n    <div id="ks-tree-node-checked-';var e=h(c,b,{},"id",0,11,f,!1);a+=i(e,!0);a+='"\r\n         class="';
var e={},d=[],j=h(c,b,{},"checkState",0,12,f,!0);d.push("checked"+j);e.params=d;b=h(c,b,e,"getBaseCssClasses",0,12,!0,f);return a+b+'"></div>\r\n    '};a+=g(c,d,b,"if",10);a+='\r\n    <div id="ks-tree-node-icon-';b=h(c,d,{},"id",0,14,f,!1);a+=i(b,!0);a+='"\r\n         class="';b={};e=[];e.push("icon");b.params=e;b=h(c,d,b,"getBaseCssClasses",0,15,!0,f);a=a+b+'">\r\n\r\n    </div>\r\n    ';b={};e=[];e.push("component/extension/content-render/content-xtpl");b.params=e;b=h(c,d,b,"include",0,18,!1,f);
a=a+b+'\r\n</div>\r\n<div id="ks-tree-node-children-';b=h(c,d,{},"id",0,20,f,!1);a+=i(b,!0);a+='"\r\n     class="';b={};e=[];e.push("children");b.params=e;b=h(c,d,b,"getBaseCssClasses",0,21,!0,f);a=a+b+'"\r\n';b={};e=[];j=h(c,d,{},"expanded",0,22,f,!0);e.push(j);b.params=e;b.fn=function(){return'\r\nstyle="display:none"\r\n'};e=b.fn;b.fn=b.inverse;b.inverse=e;a+=g(c,d,b,"if",22);return a+"\r\n>\r\n</div>"}});
KISSY.add("tree/node-render",function(d,g,f,a,c){return f.getDefaultRender().extend([c],{beforeCreateDom:function(a,c){d.mix(a.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+a.id,"aria-expanded":a.expanded?"true":"false","aria-selected":a.selected?"true":"false","aria-level":a.depth,title:a.tooltip});d.mix(c,{expandIconEl:"#ks-tree-node-expand-icon-{id}",rowEl:"#ks-tree-node-row-{id}",iconEl:"#ks-tree-node-icon-{id}",childrenEl:"#ks-tree-node-children-{id}",checkIconEl:"#ks-tree-node-checked-{id}"})},
refreshCss:function(a,c){var b=this.control,e=b.get("iconEl"),f,g=b.get("expandIconEl"),k=b.get("childrenEl");c?(b="file-icon",f="expand-icon-{t}"):b.get("expanded")?(b="expanded-folder-icon",f="expand-icon-{t}minus"):(b="collapsed-folder-icon",f="expand-icon-{t}plus");e[0].className=this.getBaseCssClasses(b);g[0].className=this.getBaseCssClasses(d.substitute(f,{t:a?"l":"t"}));k[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetExpanded:function(a){this.control.get("childrenEl")[a?
"show":"hide"]();this.el.setAttribute("aria-expanded",a)},_onSetSelected:function(a){this.control.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a)},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},_onSetCheckState:function(a){a=this.getBaseCssClasses("checked").split(/\s+/).join(a+" ")+a;this.control.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(a)},getChildrenContainerEl:function(){return this.control.get("childrenEl")}},
{ATTRS:{contentTpl:{value:a}},HTML_PARSER:{rowEl:function(a){return a.one("."+this.getBaseCssClass("row"))},childrenEl:function(a){return a.one("."+this.getBaseCssClass("children"))},isLeaf:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1},expanded:function(a){return"none"!=a.one("."+this.getBaseCssClass("children")).css("display")},expandIconEl:function(a){return a.one("."+this.getBaseCssClass("expand-icon"))},checkState:function(a){if(a=
a.one("."+this.getBaseCssClass("checked")))for(var c="checked0 checked1 checked2".split(/\s+/),b=0;b<c.length;b++)if(a.hasClass(this.getBaseCssClass(c[b])))return b;return 0},iconEl:function(a){return a.one("."+this.getBaseCssClass("icon"))},checkIconEl:function(a){return a.one("."+this.getBaseCssClass("checked"))}}})},{requires:["node","component/container","./node-xtpl","component/extension/content-render"]});
KISSY.add("tree/node",function(d,g,f,a){function c(a){if(a.target==this){var b=a.component,c=this.get("depth"),a=a.index,e=this.get("tree");e&&(k(e,b,c+1),n(this,a))}}function i(a){a.target==this&&(k(this.get("tree"),a.component),n(this,a.index))}function h(a){a.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function b(a){var b=a.get("parent"),b=(b=b&&b.get("children"))&&b[b.length-1];return!b||b==a}function e(a){var b=a.get("isLeaf");return!(!1===b||void 0===b&&a.get("children").length)}
function j(a){var b=a.get("children");return!a.get("expanded")||!b.length?a:j(b[b.length-1])}function m(a){a.get&&a.view&&a.view.refreshCss(b(a),e(a))}function k(a,b,c){void 0!==c&&b.set("depth",c);d.each(b.get("children"),function(b){"number"==typeof c?k(a,b,c+1):k(a,b)})}function n(a,b){m(a);for(var b=Math.max(0,b-1),c=a.get("children"),e,d=c.length;b<d;b++)e=c[b],m(e),e.el.setAttribute("aria-posinset",b+1)}var o=g.all,l=g.KeyCode;return f.extend({bindUI:function(){this.on("afterAddChild",c);this.on("afterRemoveChild",
i);this.on("afterAddChild afterRemoveChild",h)},syncUI:function(){m(this);h.call(this,{target:this})},handleKeyDownInternal:function(a){var b=!0,c=this.get("tree"),e=this.get("expanded"),d,f=this.get("isLeaf"),h=this.get("children");switch(a.keyCode){case l.ENTER:return this.handleClickInternal(a);case l.HOME:d=c;break;case l.END:d=j(c);break;case l.UP:d=a=(a=this.prev())?j(a):this.get("parent");break;case l.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)d=a[0];else{a=this.next();for(c=
this;!a&&(c=c.get("parent"));)a=c.next();d=a}break;case l.LEFT:e&&(h.length||!1===f)?this.set("expanded",!1):d=this.get("parent");break;case l.RIGHT:if(h.length||!1===f)e?d=h[0]:this.set("expanded",!0);break;default:b=!1}d&&d.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=d.indexOf(this,a);return b==a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=d.indexOf(this,a);return 0===b?null:a[b-
1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){var a=o(a.target),b=this.get("expanded");this.get("tree").focus();a.equals(this.get("expandIconEl"))?this.set("expanded",!b):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var a=this.get("tree");a&&(k(a,this,0),n(this,0))}},_onSetExpanded:function(a){m(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){var c=
this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);d.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);d.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:a},checkable:{value:!1,view:1},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{},iconEl:{},selected:{view:1},expanded:{sync:0,value:!1,view:1},tooltip:{view:1},tree:{getter:function(){for(var a=
this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree-node"})},{requires:["node","component/container","./node-render"]});
KISSY.add("tree/tree-manager",function(d,g,f){function a(){}var c=d.UA,i=d.Env.host.document.documentMode||c.ie,h=g.Gesture,b=d.Features.isTouchEventSupported();a.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0},handleMouseEvents:{value:!0}};d.augment(a,f,{isTree:1,__bindUI:function(){var a=this.get("prefixCls")+"tree-node",c=h.tap,c=c+" ";b||(c+=i&&9>i?"dblclick ":"");this.$el.delegate(c,"."+a,this.handleChildrenEvents,this)},_onSetSelectedItem:function(a,b){a&&b.prevVal&&
b.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return a},{requires:["node","component/extension/delegate-children"]});
KISSY.add("tree/control",function(d,g,f){return g.extend([f],{handleKeyDownInternal:function(a){var c=this.get("selectedItem");return c===this?this.callSuper(a):c&&c.handleKeyDownInternal(a)},_onSetFocused:function(a){this.callSuper(a);a&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree"})},{requires:["./node","./tree-manager"]});
KISSY.add("tree/check-node",function(d,g,f){var a=g.all,g=f.extend({handleClickInternal:function(c){var d;d=this.get("expanded");var f=this.get("expandIconEl"),b=this.get("tree"),c=a(c.target);b.focus();if(c.equals(f))this.set("expanded",!d);else return d=this.get("checkState"),this.set("checkState",1==d?0:1),this.fire("click"),!0},_onSetCheckState:function(a){var f=this.get("parent"),h,b,e,g;(1==a||0==a)&&d.each(this.get("children"),function(b){b.set("checkState",a)});if(f){h=0;g=f.get("children");
for(b=0;b<g.length;b++){e=g[b];e=e.get("checkState");if(2==e){f.set("checkState",2);return}1==e&&h++}0===h?f.set("checkState",0):h==g.length?f.set("checkState",1):f.set("checkState",2)}}},{ATTRS:{checkIconEl:{},checkable:{value:!0,view:1},checkState:{value:0,sync:0,view:1},defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree-node"});g.CheckState={PARTIAL_CHECK:2,CHECK:1,EMPTY:0};return g},{requires:["node","./node"]});
KISSY.add("tree/check-tree",function(d,g,f){return g.extend([f],{handleKeyDownInternal:function(a){var c=this.get("selectedItem");return c===this?this.callSuper(a):c&&c.handleKeyDownInternal(a)},_onSetFocused:function(a,c){this.callSuper(a,c);a&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree"})},{requires:["./check-node","./tree-manager"]});
KISSY.add("tree",function(d,g,f,a,c){g.Node=f;g.CheckNode=a;g.CheckTree=c;return g},{requires:["tree/control","tree/node","tree/check-node","tree/check-tree"]});
